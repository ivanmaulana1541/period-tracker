<!DOCTYPE html>
<html>
<head>
<title>ðŸŒ¸ Period Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
font-family:system-ui;
background:#fff5f8;
padding:20px;
max-width:500px;
margin:auto;
}

h1{
color:#d63384;
text-align:center;
}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 3px 8px rgba(0,0,0,0.1);
margin-bottom:15px;
}

button{
background:#ff4d88;
color:white;
border:none;
padding:10px;
border-radius:8px;
width:100%;
margin-top:8px;
font-size:16px;
}

input{
width:100%;
padding:10px;
border-radius:8px;
border:1px solid #ddd;
}

li{
display:flex;
justify-content:space-between;
padding:8px 0;
border-bottom:1px solid #eee;
}

.small{
font-size:14px;
color:#666;
}

#calendar{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:5px;
text-align:center;
margin-top:10px;
}

.day{
padding:8px;
border-radius:6px;
background:#f3f3f3;
font-size:12px;
}

.period{
background:#ff6b9a;
color:white;
}

.predicted{
background:#ffa94d;
color:white;
}
</style>
</head>

<body>

<h1>ðŸŒ¸ Period Tracker</h1>

<div class="card">
<input type="date" id="date">
<button onclick="add()">Simpan Tanggal</button>
</div>

<div class="card">
<h3>Prediksi berikutnya</h3>
<div id="prediction" class="small">Belum ada data</div>
</div>

<div class="card">
<h3>Kalender Siklus</h3>
<div id="calendar"></div>
</div>

<div class="card">
<h3>Riwayat</h3>
<ul id="list"></ul>
</div>

<script>

let defaultCycle = 28;

function getData(){
return JSON.parse(localStorage.getItem("period")) || [];
}

function saveData(d){
localStorage.setItem("period", JSON.stringify(d));
}

function add(){
let val=document.getElementById("date").value;
if(!val) return;

let data=getData();
data.push(val);
data.sort();
saveData(data);

update();
}

function remove(i){
let data=getData();
data.splice(i,1);
saveData(data);
update();
}

function avgCycle(){
let data=getData();
if(data.length<2) return defaultCycle;

let gaps=[];
for(let i=1;i<data.length;i++){
let d1=new Date(data[i-1]);
let d2=new Date(data[i]);
gaps.push((d2-d1)/(1000*60*60*24));
}

return Math.round(gaps.reduce((a,b)=>a+b)/gaps.length);
}

function predict(){
let data=getData();
let box=document.getElementById("prediction");

if(data.length===0){
box.innerHTML="Belum ada data";
return;
}

let cycle=avgCycle();
let last=new Date(data[data.length-1]);
let next=new Date(last);
next.setDate(next.getDate()+cycle);

let today=new Date();
let diff=Math.ceil((next-today)/(1000*60*60*24));

let status="ðŸŸ¢ Normal";
if(diff<=3 && diff>0) status="ðŸŸ  Segera datang";
if(diff<=0) status="ðŸ”´ Sedang berlangsung";

box.innerHTML=`
Perkiraan: <b>${next.toLocaleDateString()}</b><br>
Rata-rata siklus: ${cycle} hari<br>
Status: <b>${status}</b><br>
${diff>0 ? diff+" hari lagi" : "Hari ini / sedang berlangsung"}
`;
}

function drawCalendar(){
let cal=document.getElementById("calendar");
cal.innerHTML="";

let today=new Date();
let year=today.getFullYear();
let month=today.getMonth();

let firstDay=new Date(year,month,1).getDay();
let days=new Date(year,month+1,0).getDate();

let data=getData().map(d=>new Date(d).toDateString());

let next="";
if(getData().length>0){
let last=new Date(getData().slice(-1)[0]);
last.setDate(last.getDate()+avgCycle());
next=last.toDateString();
}

for(let i=0;i<firstDay;i++){
cal.innerHTML+="<div></div>";
}

for(let d=1;d<=days;d++){
let date=new Date(year,month,d);
let cls="day";

if(data.includes(date.toDateString())) cls+=" period";
if(date.toDateString()===next) cls+=" predicted";

cal.innerHTML+=`<div class="${cls}">${d}</div>`;
}
}

function update(){
let data=getData();
let list=document.getElementById("list");
list.innerHTML="";

data.forEach((d,i)=>{
let li=document.createElement("li");
li.innerHTML=`
<span>${new Date(d).toLocaleDateString()}</span>
<button onclick="remove(${i})" style="width:auto;background:#ff6b6b">Hapus</button>
`;
list.appendChild(li);
});

predict();
drawCalendar();
}

update();

</script>

</body>
</html>
