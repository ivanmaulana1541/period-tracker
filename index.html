<!DOCTYPE html>
<html>
<head>
<title>ðŸŒ™ Luna Analytics Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
font-family:system-ui;
background:#fff5f8;
padding:20px;
max-width:540px;
margin:auto;
transition:.3s;
}

.dark{background:#1f1f1f;color:white;}

h1{text-align:center;color:#d63384;}
.dark h1{color:#ff8fb3;}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 3px 8px rgba(0,0,0,.1);
margin-bottom:15px;
}

.dark .card{background:#2b2b2b;}

button{
background:#ff4d88;
color:white;
border:none;
padding:10px;
border-radius:8px;
width:100%;
margin-top:8px;
cursor:pointer;
}

.secondary{background:#777;}

input,select{
width:100%;
padding:10px;
border-radius:8px;
border:1px solid #ddd;
}

.dashboard{
display:grid;
grid-template-columns:1fr 1fr;
gap:8px;
}

.metric{
background:#ffe3ef;
padding:10px;
border-radius:8px;
text-align:center;
font-weight:bold;
}

.dark .metric{background:#333;}

.small{font-size:14px;color:#666;}
.dark .small{color:#aaa;}

#calendar{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:6px;
}

.day{
padding:8px;
text-align:center;
border-radius:8px;
background:#f5f5f5;
position:relative;
}

.dark .day{background:#3a3a3a;}

.period{background:#ff4d88;color:white;}
.prediction{background:#6c5ce7;color:white;}
.ovulation{background:#00b894;color:white;}

.mood{
position:absolute;
bottom:2px;
right:2px;
font-size:12px;
}

canvas{
width:100%;
border-radius:10px;
background:#fff;
}

.dark canvas{background:#333;}
</style>
</head>

<body>

<h1>ðŸŒ™ Luna Analytics Pro</h1>

<div class="card">
<select id="profile"></select>
<button onclick="newProfile()">+ Profile</button>
<button class="secondary" onclick="toggleDark()">Dark Mode</button>
<button class="secondary" onclick="resetAll()">Reset</button>
</div>

<div class="card">
<input type="date" id="date">
<button onclick="add()">Tambah + Mood</button>
</div>

<div class="card">
<h3>Analytics Dashboard</h3>
<div class="dashboard">
<div class="metric" id="avg"></div>
<div class="metric" id="var"></div>
<div class="metric" id="trend"></div>
<div class="metric" id="next"></div>
<div class="metric" id="ovu"></div>
</div>
<p class="small" id="insight"></p>
</div>

<div class="card">
<h3>Grafik Siklus</h3>
<canvas id="chart" height="150"></canvas>
<div id="chartInfo" class="small"></div>
</div>

<div class="card">
<h3>Kalender</h3>
<div id="calendar"></div>
</div>

<script>

// DARK MODE
if(localStorage.dark==="1")
document.body.classList.add("dark");

function toggleDark(){
document.body.classList.toggle("dark");
localStorage.dark=document.body.classList.contains("dark")?"1":"0";
}

// PROFILE
let profiles=JSON.parse(localStorage.lunaProfiles||"{}");
if(!profiles.Default) profiles.Default=[];
let current="Default";

function saveProfiles(){
localStorage.lunaProfiles=JSON.stringify(profiles);
}

function refreshProfiles(){
let sel=document.getElementById("profile");
sel.innerHTML="";
Object.keys(profiles).forEach(p=>{
let o=document.createElement("option");
o.textContent=p;
sel.appendChild(o);
});
sel.value=current;
}

document.getElementById("profile").onchange=e=>{
current=e.target.value;
render();
};

function newProfile(){
let n=prompt("Nama profile?");
if(!n)return;
profiles[n]=[];
saveProfiles();
refreshProfiles();
}

// DATA
function getData(){return profiles[current];}

function add(){
let d=document.getElementById("date").value;
if(!d)return;

let mood=prompt("Mood hari ini? ðŸ˜Š","");
getData().push({date:d,mood});
getData().sort((a,b)=>a.date.localeCompare(b.date));
saveProfiles();
render();
}

function resetAll(){
if(confirm("Reset profile ini?")){
profiles[current]=[];
saveProfiles();
render();
}
}

// ANALYTICS
function analyze(){
let arr=getData();
if(arr.length<2)return null;

let gaps=[];
for(let i=1;i<arr.length;i++){
let a=new Date(arr[i-1].date);
let b=new Date(arr[i].date);
gaps.push((b-a)/86400000);
}

let avg=gaps.reduce((a,b)=>a+b)/gaps.length;
let variance=gaps.map(x=>(x-avg)**2)
.reduce((a,b)=>a+b)/gaps.length;

let trend="Stabil";
if(gaps.length>=3){
let recent=gaps.slice(-3)
.reduce((a,b)=>a+b)/3;

if(recent>avg+1)trend="Memanjang";
if(recent<avg-1)trend="Memendek";
}

return {avg,variance,gaps,trend};
}

// GRAPH
function drawChart(gaps){
let c=document.getElementById("chart");
let ctx=c.getContext("2d");
ctx.clearRect(0,0,c.width,c.height);

if(!gaps||!gaps.length)return;

let max=Math.max(...gaps)+2;
let step=c.width/(gaps.length+1);

ctx.strokeStyle="#ff4d88";
ctx.lineWidth=3;
ctx.beginPath();

gaps.forEach((v,i)=>{
let x=step*(i+1);
let y=c.height-(v/max)*c.height;
if(i===0)ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});

ctx.stroke();

c.onclick=e=>{
let i=Math.floor(e.offsetX/step)-1;
if(gaps[i])
document.getElementById("chartInfo")
.innerText="Interval: "+Math.round(gaps[i])+" hari";
};
}

// CALENDAR
function buildCalendar(avg){
let cal=document.getElementById("calendar");
cal.innerHTML="";

let today=new Date();
let y=today.getFullYear();
let m=today.getMonth();
let days=new Date(y,m+1,0).getDate();

let arr=getData();

let predicted=null,ovu=null;

if(arr.length&&avg){
predicted=new Date(arr.at(-1).date);
predicted.setDate(predicted.getDate()+avg);

ovu=new Date(predicted);
ovu.setDate(predicted.getDate()-14);
}

for(let d=1;d<=days;d++){
let cell=document.createElement("div");
cell.className="day";
cell.textContent=d;

let date=new Date(y,m,d);
let iso=date.toISOString().split("T")[0];

let rec=arr.find(x=>x.date===iso);

if(rec){
cell.classList.add("period");
if(rec.mood){
let m=document.createElement("div");
m.className="mood";
m.textContent=rec.mood;
cell.appendChild(m);
}
}

if(predicted&&date.toDateString()===predicted.toDateString())
cell.classList.add("prediction");

if(ovu&&date.toDateString()===ovu.toDateString())
cell.classList.add("ovulation");

cal.appendChild(cell);
}
}

// RENDER
function render(){
let a=analyze();

if(a){
let next=new Date(getData().at(-1).date);
next.setDate(next.getDate()+Math.round(a.avg));

let ovu=new Date(next);
ovu.setDate(next.getDate()-14);

document.getElementById("avg").innerText=
"Avg: "+Math.round(a.avg)+" hari";

document.getElementById("var").innerText=
"Variasi: "+Math.round(a.variance);

document.getElementById("trend").innerText=
"Trend: "+a.trend;

document.getElementById("next").innerText=
"Next: "+next.toLocaleDateString();

document.getElementById("ovu").innerText=
"Ovulasi: "+ovu.toLocaleDateString();

document.getElementById("insight").innerText=
"Siklus "+a.trend+
" dengan variasi "+Math.round(a.variance)+
". Pantau kesehatan secara rutin.";

drawChart(a.gaps);
buildCalendar(Math.round(a.avg));
}
else{
document.getElementById("insight").innerText=
"Tambahkan minimal 2 data.";
buildCalendar();
}
}

// INIT
refreshProfiles();
render();

</script>

</body>
</html>
