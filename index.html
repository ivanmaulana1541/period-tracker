<!DOCTYPE html>
<html>
<head>
<title>ðŸŒ™ Luna Period Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
body{
font-family:system-ui;
background:#fff5f8;
padding:20px;
max-width:500px;
margin:auto;
}

h1{
color:#d63384;
text-align:center;
}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 3px 8px rgba(0,0,0,0.1);
margin-bottom:15px;
animation:fade .4s ease;
}

@keyframes fade{
from{opacity:0;transform:translateY(10px)}
to{opacity:1;transform:translateY(0)}
}

button{
background:#ff4d88;
color:white;
border:none;
padding:12px;
border-radius:8px;
width:100%;
margin-top:8px;
font-size:16px;
cursor:pointer;
}

button:active{
transform:scale(.98);
}

input{
width:100%;
padding:10px;
border-radius:8px;
border:1px solid #ddd;
}

li{
display:flex;
justify-content:space-between;
padding:8px 0;
border-bottom:1px solid #eee;
}

.small{
font-size:14px;
color:#666;
}
</style>
</head>

<body>

<h1>ðŸŒ™ Luna Period Tracker</h1>

<div class="card">
<input type="date" id="date">
<button onclick="add()">Simpan Tanggal</button>
</div>

<div class="card">
<h3>Prediksi berikutnya</h3>
<div id="prediction">Belum ada data</div>
</div>

<div class="card">
<h3>Statistik</h3>
<div id="stats"></div>
</div>

<div class="card">
<h3>Riwayat</h3>
<ul id="history"></ul>
</div>

<script>
if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}

let data = JSON.parse(localStorage.getItem("luna")) || [];

function save(){
localStorage.setItem("luna", JSON.stringify(data));
}

function add(){
let date = document.getElementById("date").value;
if(!date) return;

let mood = prompt("Mood hari ini? ðŸ˜ŠðŸ˜´ðŸ˜¡","");
data.push({date,mood});

data.sort((a,b)=>new Date(a.date)-new Date(b.date));

save();
render();
}

function avgCycle(){
if(data.length<2) return null;

let gaps=[];

for(let i=1;i<data.length;i++){
let d1=new Date(data[i-1].date);
let d2=new Date(data[i].date);
gaps.push((d2-d1)/(1000*60*60*24));
}

return Math.round(gaps.reduce((a,b)=>a+b)/gaps.length);
}

function predict(){
let avg=avgCycle();
if(!avg) return "Belum cukup data";

let last=new Date(data[data.length-1].date);
last.setDate(last.getDate()+avg);

return last.toLocaleDateString();
}

function render(){

let list=document.getElementById("history");
list.innerHTML="";

data.slice().reverse().forEach(item=>{
let li=document.createElement("li");

li.innerHTML=`
<div>
${new Date(item.date).toLocaleDateString()}
<div class="small">${item.mood || ""}</div>
</div>
`;

list.appendChild(li);
});

document.getElementById("prediction").innerText=predict();

let avg=avgCycle();

document.getElementById("stats").innerText=
avg ? `Rata-rata siklus: ${avg} hari` : "Belum cukup data";
}

render();
</script>

</body>
</html>
