<!DOCTYPE html>
<html>
<head>
<title>ðŸŒ™ Luna Period Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
body{
font-family:system-ui;
background:#fff5f8;
padding:20px;
max-width:560px;
margin:auto;
transition:.3s;
}

.dark{background:#1f1f1f;color:white;}

h1{text-align:center;color:#d63384;}
.dark h1{color:#ff8fb3;}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 3px 8px rgba(0,0,0,0.1);
margin-bottom:15px;
transition:.3s;
}

.dark .card{background:#2b2b2b;}

button{
background:#ff4d88;
color:white;
border:none;
padding:12px;
border-radius:8px;
width:100%;
margin-top:8px;
cursor:pointer;
}

.secondary{background:#999;}

.calendar{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:4px;
text-align:center;
}

.header{
font-weight:bold;
font-size:13px;
opacity:.7;
}

.day{
padding:8px 0;
border-radius:6px;
background:#f0f0f0;
}

.dark .day{background:#3a3a3a;}

.period{background:#ffb3c9;}
.predicted{background:#ffc4e1;}
.fertile{background:#b8f0ff;}

.small{font-size:14px;color:#666;}
.dark .small{color:#aaa;}

canvas{width:100%}
</style>
</head>

<body>

<h1>ðŸŒ™ Luna Period Tracker</h1>

<div class="card">
<select id="profile"></select>
<button onclick="newProfile()">+ Profile</button>
<button class="secondary" onclick="toggleDark()">Dark Mode</button>
</div>

<div class="card">
<input type="date" id="date">
<button onclick="add()">Tambah Periode</button>
</div>

<div class="card">
<h3>AI Dashboard</h3>
<div id="dashboard"></div>
</div>

<div class="card">
<h3>Prediksi berikutnya</h3>
<div id="prediction"></div>
<div id="phase" class="small"></div>
</div>

<div class="card">
<h3>Kalender Profesional</h3>
<div id="calendar" class="calendar"></div>
</div>

<div class="card">
<h3>Statistik</h3>
<div id="stats"></div>
<canvas id="chart"></canvas>
</div>

<script>
let data = JSON.parse(localStorage.getItem("lunaData") || "[]");

function save(){
localStorage.setItem("lunaData", JSON.stringify(data));
}

function add(){
let val = document.getElementById("date").value;
if(!val) return;

data.push(val);
data.sort();
save();

document.getElementById("date").value="";
render();
}

function resetData(){
if(confirm("Reset semua data Luna?")){
data=[];
save();
render();
}
}

function daysBetween(a,b){
return Math.round((new Date(b)-new Date(a))/(1000*60*60*24));
}

function analyze(){
if(data.length<2){
return {
avg:0,
stability:"Belum cukup data",
confidence:"Rendah",
intervals:[]
};
}

let intervals=[];
for(let i=1;i<data.length;i++){
intervals.push(daysBetween(data[i-1],data[i]));
}

let avg = intervals.reduce((a,b)=>a+b)/intervals.length;

let variance = intervals
.map(x=>(x-avg)**2)
.reduce((a,b)=>a+b)/intervals.length;

let sd = Math.sqrt(variance);

let stability="Tinggi";
let confidence="Tinggi";

if(sd>5){
stability="Rendah";
confidence="Rendah";
}
else if(sd>2){
stability="Sedang";
confidence="Sedang";
}

return {avg,stability,confidence,intervals};
}

function predict(avg){
if(!data.length || !avg) return "Belum ada prediksi";

let last = new Date(data[data.length-1]);
last.setDate(last.getDate()+Math.round(avg));

return last.toLocaleDateString();
}

function drawChart(intervals){
let canvas=document.getElementById("chart");
let ctx=canvas.getContext("2d");

ctx.clearRect(0,0,canvas.width,canvas.height);

if(intervals.length<2) return;

let max=Math.max(...intervals);
let min=Math.min(...intervals);

ctx.beginPath();
ctx.strokeStyle="#ff4d88";
ctx.lineWidth=3;

intervals.forEach((v,i)=>{
let x=(i/(intervals.length-1))*canvas.width;
let y=canvas.height-((v-min)/(max-min||1))*canvas.height;

if(i===0) ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});

ctx.stroke();
}

function insight(a){
if(a.stability==="Tinggi")
return "âœ¨ Siklus stabil. Prediksi sangat akurat.";

if(a.stability==="Sedang")
return "ðŸ“ˆ Siklus cukup stabil. Pantau perubahan.";

return "âš  Siklus bervariasi. Perhatikan kesehatan.";
}

function render(){
let a=analyze();

document.getElementById("prediction").innerHTML=
"Prediksi berikutnya: <b>"+predict(a.avg)+"</b>";

document.getElementById("stats").innerHTML=`
Rata-rata siklus: ${a.avg?Math.round(a.avg)+" hari":"-"}<br>
Stabilitas: ${a.stability}<br>
Confidence: ${a.confidence}<br>
${insight(a)}
`;

let list=document.getElementById("history");
list.innerHTML="";

data.forEach(d=>{
let li=document.createElement("li");
li.textContent=new Date(d).toLocaleDateString();
list.appendChild(li);
});

drawChart(a.intervals);
}

render();
</script>


</body>
</html>
